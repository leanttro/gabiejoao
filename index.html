<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carregando...</title> <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=Montserrat:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #2D4A6E; 
            --primary-light: #5B7AA5;
            --accent: #A5C4D4; 
            --bg-light: #FDFDFD; 
            --bg-section: #F0F4F8; 
            --text-main: #2C3E50;
            --text-muted: #7F8C8D;
            --font-serif: 'Cormorant Garamond', serif;
            --font-sans: 'Montserrat', sans-serif;
            --transition: all 1.2s cubic-bezier(0.2, 1, 0.3, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font-sans);
            background-color: var(--bg-light);
            color: var(--text-main);
            line-height: 1.8;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* Loading Overlay */
        #loader {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: white; z-index: 10000;
            display: flex; justify-content: center; align-items: center;
            font-family: var(--font-serif); font-size: 2rem; color: var(--primary);
            transition: opacity 0.5s;
        }

        /* --- Chuva de Flores --- */
        #flower-fall-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }

        .falling-flower {
            position: absolute;
            top: -100px;
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.6;
            pointer-events: none;
            animation: fall linear forwards;
        }

        @keyframes fall {
            0% { transform: translateY(0) rotate(0deg) translateX(0); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translateY(110vh) rotate(360deg) translateX(50px); opacity: 0; }
        }

        /* --- Reveal --- */
        .reveal { opacity: 0; transform: translateY(50px); transition: var(--transition); }
        .reveal.active { opacity: 1; transform: translateY(0); }

        .container { width: 85%; max-width: 1100px; margin: 0 auto; position: relative; }

        /* --- Header & Menu Mobile --- */
        header {
            position: fixed;
            top: 0; left: 0; width: 100%; z-index: 1000;
            padding: 2rem 0; transition: var(--transition);
        }
        header.scrolled {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.03);
        }
        nav { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-family: var(--font-serif); font-size: 2.2rem; color: var(--primary); text-decoration: none; letter-spacing: 5px; font-style: italic; z-index: 1001; }
        
        .nav-links { display: flex; gap: 2rem; list-style: none; }
        .nav-links a { color: var(--text-main); text-decoration: none; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 2px; font-weight: 600; opacity: 0.8; }
        .nav-links a:hover { color: var(--primary); opacity: 1; }

        .mobile-toggle {
            display: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--primary);
            z-index: 1001;
        }

        /* --- HERO --- */
        #home {
            height: 100vh;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            overflow: hidden;
        }

        .slideshow {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
        }

        .slide {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 2.5s ease-in-out;
            transform: scale(1.1);
        }

        .slide.active { opacity: 1; animation: kenBurnsEffect 15s ease-out forwards; }

        @keyframes kenBurnsEffect {
            0% { transform: scale(1.1); }
            100% { transform: scale(1.02); }
        }

        .hero-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(180deg, rgba(255,255,255,0.7) 0%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.7) 100%);
            z-index: 0;
        }

        .hero-content { z-index: 10; padding: 2rem; max-width: 900px; }

        .hero-content h1 { 
            font-size: clamp(3.5rem, 12vw, 8rem); 
            margin: 0.2rem 0; 
            color: var(--primary); 
            font-family: var(--font-serif);
            font-weight: 800; 
            line-height: 1;
            text-shadow: 0 1px 15px rgba(255,255,255,1);
        }

        .hero-subtitle { 
            text-transform: uppercase; 
            letter-spacing: 6px; 
            font-size: 1rem; 
            color: var(--primary); 
            margin-bottom: 1rem;
            font-weight: 700; 
            text-shadow: 0 0 20px rgba(255,255,255,1);
        }

        .hero-date { 
            font-size: 2.4rem; 
            font-family: var(--font-serif); 
            font-style: italic; 
            color: var(--text-main); 
            margin-bottom: 4rem; 
            letter-spacing: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 25px;
            font-weight: 900; 
        }

        .hero-date::before, .hero-date::after {
            content: '';
            width: 70px;
            height: 4px; 
            background: var(--primary);
            display: inline-block;
        }

        .btn-hero {
            display: inline-block; 
            padding: 1.4rem 4.5rem; 
            background: var(--primary); 
            color: white;
            text-decoration: none; 
            text-transform: uppercase; 
            font-size: 0.9rem; 
            letter-spacing: 5px;
            border-radius: 2px;
            transition: var(--transition);
            border: 3px solid var(--primary);
            font-weight: 800;
            cursor: pointer;
        }

        .btn-hero:hover { 
            background: transparent;
            color: var(--primary);
            transform: translateY(-5px);
        }

        /* --- Seções Estilo --- */
        section { padding: 140px 0; position: relative; }
        .section-header { text-align: center; margin-bottom: 80px; }
        .section-header h2 { font-size: 3.5rem; font-family: var(--font-serif); color: var(--primary); font-weight: 500; }

        /* --- Nossa História --- */
        #historia {
            padding-top: 70px; 
            padding-bottom: 70px; 
            background-color: var(--bg-section);
            background-image: radial-gradient(circle at 10% 20%, rgba(165, 196, 212, 0.2) 0%, transparent 40%),
                              radial-gradient(circle at 90% 80%, rgba(165, 196, 212, 0.2) 0%, transparent 40%);
        }
        
        .history-card {
            display: flex;
            gap: 5rem;
            margin-bottom: 10rem;
            align-items: center;
        }

        #historia .history-card:last-of-type {
            margin-bottom: 5rem; 
        }

        .history-card:nth-child(even) { flex-direction: row-reverse; }

        .history-img-box {
            flex: 1.2;
            position: relative;
        }

        /* Moldura de Aguarela */
        .history-img-box img {
            width: 100%;
            height: 450px;
            object-fit: cover;
            border-radius: 120px 30px 120px 30px;
            box-shadow: 25px 25px 70px rgba(0,0,0,0.06);
            transition: var(--transition);
        }

        .history-card:hover .history-img-box img { transform: scale(1.03) rotate(1deg); }

        .history-text-box { flex: 1; }
        .history-tag { font-family: var(--font-serif); font-size: 4rem; color: var(--accent); font-style: italic; opacity: 0.7; margin-bottom: -15px; display: block; }
        .history-text-box h3 { font-size: 2.2rem; margin-bottom: 1.5rem; color: var(--primary); }

        /* --- Eventos --- */
        #eventos {
            padding-top: 70px; 
        }
        .events-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 3rem; }
        .event-card { background: white; padding: 4rem 2rem; text-align: center; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.03); border: 1px solid rgba(165, 196, 212, 0.2); transition: var(--transition); }
        .event-card:hover { transform: translateY(-10px); }
        .event-card i { font-size: 2.5rem; color: var(--accent); margin-bottom: 2rem; }
        .map-wrapper { margin-top: 4rem; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.05); }

        /* --- Presentes --- */
        #presentes {
            padding-top: 70px; 
        }
        .pix-area { background: white; padding: 4rem; border-radius: 30px; border: 2px dashed var(--accent); margin: 3rem 0; text-align: center; }
        .pix-key { font-size: 1.4rem; font-weight: 700; color: var(--primary); padding: 15px; background: var(--bg-section); display: inline-block; border-radius: 10px; margin-top: 1rem; }
        .gift-buttons { display: flex; gap: 2rem; justify-content: center; margin-top: 2rem; }

        /* --- Recados --- */
        #recados {
            padding-top: 70px; 
        }
        .messages-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }
        .message-item { background: white; padding: 3rem; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.02); border-left: 5px solid var(--accent); font-style: italic; }

        /* --- RSVP --- */
        #rsvp {
            padding-top: 70px; /* Reduzido pela metade */
        }
        .rsvp-container { max-width: 800px; margin: 0 auto; background: white; padding: 5rem; border-radius: 35px; box-shadow: 0 30px 60px rgba(0,0,0,0.04); border: 1px solid rgba(165, 196, 212, 0.2); }
        .form-control { width: 100%; border: none; border-bottom: 2px solid #E9F0F5; padding: 15px 0; margin-bottom: 2.5rem; font-size: 1.1rem; outline: none; }

        /* --- Modal de Recados --- */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 2000; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.5); 
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 10% auto; 
            padding: 40px;
            border-radius: 20px;
            border: 1px solid #888;
            width: 90%; 
            max-width: 600px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
            position: relative;
            animation: modalFadeIn 0.3s;
        }

        @keyframes modalFadeIn {
            from {opacity: 0; transform: translateY(-50px);}
            to {opacity: 1; transform: translateY(0);}
        }

        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-modal:hover,
        .close-modal:focus {
            color: var(--primary);
            text-decoration: none;
            cursor: pointer;
        }

        footer { background: var(--primary); color: white; text-align: center; padding: 90px 0; }

        @media (max-width: 900px) {
            .mobile-toggle { display: block; }
            .nav-links {
                position: fixed; top: 0; right: -100%; width: 80%; height: 100vh;
                background: white; flex-direction: column; justify-content: center; align-items: center;
                gap: 2.5rem; transition: 0.5s; box-shadow: -15px 0 40px rgba(0,0,0,0.05); z-index: 1000;
            }
            .nav-links.active { right: 0; }
            
            /* Ajuste Mobile História */
            .history-card, .history-card:nth-child(even) { flex-direction: column; gap: 3rem; text-align: center; }
            .history-img-box img { height: 350px; }
            
            .events-grid { grid-template-columns: 1fr; }
            .hero-content h1 { font-size: 3.8rem; }
            .gift-buttons { flex-direction: column; }
        }
    </style>
</head>
<body>
    
    <div id="loader">Carregando Amor...</div>

    <div id="flower-fall-container"></div>

    <header id="main-header">
        <div class="container">
            <nav>
                <a href="#home" class="logo" id="nav-logo">G&J</a>
                <ul class="nav-links" id="nav-menu">
                    <li><a href="#home">Início</a></li>
                    <li><a href="#casal">O Casal</a></li>
                    <li><a href="#historia">Nossa História</a></li>
                    <li><a href="#eventos">Eventos</a></li>
                    <li><a href="#presentes">Presentes</a></li>
                    <li><a href="#recados">Recados</a></li>
                    <li><a href="#rsvp">RSVP</a></li>
                </ul>
                <div class="mobile-toggle" id="mobile-toggle"><i class="fas fa-bars"></i></div>
            </nav>
        </div>
    </header>

    <section id="home">
        <div class="slideshow" id="hero-slideshow">
            </div>
        <div class="hero-overlay"></div>
        <div class="hero-content reveal">
            <p class="hero-subtitle" id="hero-subtitle">Carregando...</p>
            <h1 id="hero-title">...</h1>
            <p class="hero-date" id="hero-date">...</p>
            <a href="#rsvp" class="btn-hero">Confirmar Presença</a>
        </div>
    </section>

    <section id="casal">
        <div class="container">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5rem; align-items: center;">
                <div class="reveal">
                    <img src="" alt="O Casal" id="casal-foto" style="width: 100%; border-radius: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.05);">
                </div>
                <div class="reveal">
                    <h2 style="font-family: var(--font-serif); font-size: 3rem; margin-bottom: 2rem;">O Casal</h2>
                    <p id="casal-texto">...</p>
                    <div style="font-family: var(--font-serif); font-size: 2.5rem; font-style: italic; color: var(--primary); margin-top: 3rem;" id="casal-assinatura">...</div>
                </div>
            </div>
        </div>
    </section>

    <section id="historia">
        <div class="container">
            <div class="section-header reveal">
                <h2>Nossa História</h2>
                <p>Momentos inesquecíveis da nossa caminhada.</p>
            </div>
            <div id="historia-container">
                </div>
        </div>
    </section>

    <section id="eventos" style="background: var(--bg-section);">
        <div class="container">
            <div class="section-header reveal">
                <h2>Onde e Quando</h2>
            </div>
            <div class="events-grid" id="eventos-container">
                </div>
            <div class="map-wrapper reveal">
                <iframe id="mapa-iframe" src="" width="100%" height="400" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
            </div>
        </div>
    </section>

    <section id="presentes">
        <div class="container">
            <div class="section-header reveal">
                <h2>Lista de Presentes</h2>
            </div>
            <div class="pix-area reveal">
                <i class="fas fa-heart" style="font-size: 2.5rem; color: var(--accent); margin-bottom: 1rem;"></i>
                <h3>Presente via PIX</h3>
                <div class="pix-key" id="pix-key-text">Carregando...</div>
                <div style="margin-top: 15px;">
                    <button id="btn-copy-pix" class="btn-hero" style="padding: 1rem 2rem; font-size: 0.8rem;">Copiar Chave</button>
                </div>
                <p style="margin-top: 1rem; color: var(--text-muted);">Copie a chave para contribuir com nossa Lua de Mel.</p>
            </div>
            <div class="gift-buttons reveal">
                <a href="#" id="btn-lista-1" class="btn-hero" style="font-size: 0.7rem; padding: 1rem 2rem; display:none;">Lista 1</a>
                <a href="#" id="btn-lista-2" class="btn-hero" style="font-size: 0.7rem; padding: 1rem 2rem; display:none;">Lista 2</a>
            </div>
        </div>
    </section>

    <section id="recados" style="background: var(--bg-section);">
        <div class="container">
            <div class="section-header reveal">
                <h2>Recados Carinhosos</h2>
                <div style="margin-top: 2rem;">
                    <button id="btn-open-modal" class="btn-hero" style="font-size: 0.8rem; padding: 1rem 3rem;">Deixar um Recado</button>
                </div>
            </div>
            <div class="messages-grid" id="recados-container">
                </div>
        </div>
    </section>

    <div id="messageModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">×</span>
            <h3 style="font-family: var(--font-serif); font-size: 2rem; color: var(--primary); margin-bottom: 1.5rem; text-align: center;">Deixe sua Mensagem</h3>
            <form id="message-form">
                <input type="text" id="msg_name" class="form-control" placeholder="Seu Nome" required>
                <input type="text" id="msg_code" class="form-control" placeholder="Código do Convite (Opcional)">
                <textarea id="message_text" class="form-control" placeholder="Escreva sua mensagem para os noivos..." rows="4" required style="border-bottom: 2px solid #E9F0F5; resize: none;"></textarea>
                <button type="submit" class="btn-hero" style="width: 100%; margin-top: 1rem;">Enviar para Aprovação</button>
            </form>
            <div id="message-feedback" style="display:none; text-align:center; margin-top: 1rem; color: var(--primary); font-weight: bold;">
                Mensagem enviada para aprovação!
            </div>
        </div>
    </div>

    <section id="rsvp">
        <div class="container">
            <div class="section-header reveal">
                <h2>Confirmar Presença</h2>
                <p>Por favor, confirme até a data informada.</p>
            </div>
            <div class="rsvp-container reveal">
                <form id="rsvp-form">
                    <input type="text" id="rsvp_code" class="form-control" placeholder="Código do Convite" required>
                    <input type="text" id="rsvp_name" class="form-control" placeholder="Seu Nome Completo" required>
                    <input type="email" id="rsvp_email" class="form-control" placeholder="Seu e-mail" required>
                    <select id="rsvp_guests" class="form-control">
                        <option value="1">Apenas eu</option>
                        <option value="2">2 Pessoas</option>
                        <option value="3">3 Pessoas</option>
                        <option value="4">4 Pessoas</option>
                        <option value="5">5 Pessoas</option>
                        <option value="6">6 Pessoas</option>
                    </select>
                    <button type="submit" class="btn-hero" style="width: 100%;">Confirmar Agora</button>
                </form>
                <div id="form-feedback" style="display:none; text-align:center; margin-top: 2rem;">
                    <h3 style="font-family: var(--font-serif); font-size: 2rem; color: var(--primary);">Obrigado! Presença confirmada.</h3>
                </div>
                <div id="form-error" style="display:none; text-align:center; margin-top: 2rem; color: red;">
                    Erro ao confirmar. Verifique os dados.
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-logo" id="footer-text">Gabi & João</div>
            <p id="footer-date">2026</p>
        </div>
    </footer>

    <script>
        // --- CONFIGURAÇÃO DIRECTUS ---
        const DIRECTUS_URL = "https://eventosdirectus.leanttro.com"; // Seu domínio
        
        // Função Helper para pegar URL da Imagem
        function getImgUrl(fileId) {
            if (!fileId) return '';
            return `${DIRECTUS_URL}/assets/${fileId}`;
        }

        // Função Principal de Carregamento
        async function loadSiteData() {
            try {
                // 1. Carregar Configurações Gerais (Singleton)
                const configReq = await fetch(`${DIRECTUS_URL}/items/configuracoes_gerais`);
                const configData = await configReq.json();
                const config = configData.data;

                // Preencher HTML
                document.title = config.titulo_site;
                document.getElementById('nav-logo').innerText = config.titulo_site;
                document.getElementById('footer-text').innerText = config.titulo_site;
                document.getElementById('hero-title').innerText = config.titulo_site;
                document.getElementById('casal-assinatura').innerText = config.titulo_site;
                document.getElementById('hero-subtitle').innerText = config.subtitulo_hero;
                document.getElementById('casal-texto').innerText = config.texto_casal;
                document.getElementById('casal-foto').src = getImgUrl(config.foto_casal);
                document.getElementById('pix-key-text').innerText = config.chave_pix;
                document.getElementById('mapa-iframe').src = config.iframe_mapa;

                // Formatar Data
                const dataObj = new Date(config.data_casamento);
                const dataFormatada = dataObj.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' }).replace(/\//g, ' . ');
                document.getElementById('hero-date').innerText = dataFormatada;
                document.getElementById('footer-date').innerText = `BRASÍLIA • ${dataObj.getFullYear()}`;

                // Botões de Lista
                if(config.link_lista_1) {
                    const btn1 = document.getElementById('btn-lista-1');
                    btn1.href = config.link_lista_1;
                    btn1.style.display = 'inline-block';
                    btn1.innerText = "Lista de Presentes 1";
                }
                if(config.link_lista_2) {
                    const btn2 = document.getElementById('btn-lista-2');
                    btn2.href = config.link_lista_2;
                    btn2.style.display = 'inline-block';
                    btn2.innerText = "Lista de Presentes 2";
                }

                // Slideshow Hero (Se você tiver um campo imagens_hero (multiplas) ou usar fixo, aqui deixei pra ser 3 fixas no CSS, mas você pode adaptar)
                // Se quiser dinâmico, precisaria de uma tabela de 'banners' ou campo repeater.
                
                // 2. Carregar História
                const histReq = await fetch(`${DIRECTUS_URL}/items/historia?sort=sort`);
                const histData = await histReq.json();
                const histContainer = document.getElementById('historia-container');
                
                histData.data.forEach((item) => {
                    const html = `
                    <div class="history-card reveal">
                        <div class="history-img-box">
                            <img src="${getImgUrl(item.foto)}" alt="${item.titulo}">
                        </div>
                        <div class="history-text-box">
                            <span class="history-tag">${item.ano}</span>
                            <h3>${item.titulo}</h3>
                            <p>${item.descricao}</p>
                        </div>
                    </div>`;
                    histContainer.innerHTML += html;
                });

                // 3. Carregar Eventos
                const eventReq = await fetch(`${DIRECTUS_URL}/items/eventos?sort=sort`);
                const eventData = await eventReq.json();
                const eventContainer = document.getElementById('eventos-container');
                
                eventData.data.forEach(item => {
                    const dataEvento = new Date(item.data_hora);
                    const dia = dataEvento.toLocaleDateString('pt-BR', { day: 'numeric', month: 'long' });
                    const hora = dataEvento.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                    
                    const html = `
                    <div class="event-card reveal">
                        <i class="fas ${item.icone}"></i>
                        <h3>${item.titulo}</h3>
                        <p>${dia}<br>${hora}h</p>
                        <p style="margin-top: 10px; font-weight: 700;">${item.local_nome}</p>
                    </div>`;
                    eventContainer.innerHTML += html;
                });

                // 4. Carregar Recados (Aprovados)
                const recadosReq = await fetch(`${DIRECTUS_URL}/items/recados?filter[status][_eq]=published&sort=-date_created&limit=6`);
                const recadosData = await recadosReq.json();
                const recadosContainer = document.getElementById('recados-container');

                if(recadosData.data.length > 0) {
                    recadosData.data.forEach(msg => {
                        const html = `
                        <div class="message-item reveal">
                            <p>"${msg.mensagem}"</p>
                            <span style="display:block; margin-top:1rem; font-weight:700;">— ${msg.nome_remetente}</span>
                        </div>`;
                        recadosContainer.innerHTML += html;
                    });
                } else {
                    recadosContainer.innerHTML = '<p style="text-align:center; width:100%;">Seja o primeiro a deixar um recado!</p>';
                }

                // Remove Loader
                document.getElementById('loader').style.opacity = '0';
                setTimeout(() => document.getElementById('loader').remove(), 500);
                
                // Re-inicializa reveals
                setTimeout(initAnimations, 100);

            } catch (error) {
                console.error("Erro ao carregar dados:", error);
                document.getElementById('loader').innerText = "Erro ao carregar o site.";
            }
        }

        // --- ENVIAR FORMS ---

        // RSVP
        document.getElementById('rsvp-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            const originalText = btn.innerText;
            btn.innerText = 'Enviando...';

            const payload = {
                codigo_convite: document.getElementById('rsvp_code').value,
                nome_completo: document.getElementById('rsvp_name').value,
                email: document.getElementById('rsvp_email').value,
                qtd_convidados: parseInt(document.getElementById('rsvp_guests').value)
            };

            try {
                const res = await fetch(`${DIRECTUS_URL}/items/rsvp`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if(res.ok) {
                    document.getElementById('rsvp-form').style.display = 'none';
                    document.getElementById('form-feedback').style.display = 'block';
                } else {
                    throw new Error('Erro no envio');
                }
            } catch (err) {
                document.getElementById('form-error').style.display = 'block';
                btn.innerText = originalText;
            }
        });

        // Recados
        document.getElementById('message-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.innerText = 'Enviando...';

            const payload = {
                status: 'draft', // Vai para aprovação
                nome_remetente: document.getElementById('msg_name').value,
                codigo_convite: document.getElementById('msg_code').value,
                mensagem: document.getElementById('message_text').value
            };

            try {
                await fetch(`${DIRECTUS_URL}/items/recados`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                document.getElementById('message-form').style.display = 'none';
                document.getElementById('message-feedback').style.display = 'block';
                setTimeout(() => {
                    document.getElementById("messageModal").style.display = "none";
                }, 2000);

            } catch (err) {
                alert("Erro ao enviar mensagem.");
                btn.innerText = 'Tentar Novamente';
            }
        });

        // --- EFEITOS VISUAIS (Mantidos do original) ---
        function initAnimations() {
            // Chuva de Flores
            const flowerContainer = document.getElementById('flower-fall-container');
            const flowerImages = ['flor1.png', 'flor2.png', 'flor3.png', 'flor4.png']; // Certifique-se que essas imagens existem na pasta public ou static
            // (Nota: Se quiser puxar flores do banco, precisaria alterar aqui também)

            function createFlower() {
                const flower = document.createElement('div');
                flower.classList.add('falling-flower');
                const size = Math.random() * (30 - 15) + 15; 
                const startX = Math.random() * window.innerWidth;
                const duration = Math.random() * (12 - 7) + 7; 
                // Placeholder se as imagens não existirem localmente
                // flower.style.backgroundImage = `url('flor1.png')`; 
                flowerContainer.appendChild(flower);
                setTimeout(() => { flower.remove(); }, duration * 1000);
            }
            // setInterval(createFlower, 600); // Descomente se tiver as imagens

            // Reveal
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('active');
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
        }

        // Header Scroll
        window.addEventListener('scroll', () => {
            const header = document.querySelector('header');
            if (window.scrollY > 50) header.classList.add('scrolled');
            else header.classList.remove('scrolled');
        });

        // Mobile Menu
        const mobileToggle = document.getElementById('mobile-toggle');
        const navMenu = document.getElementById('nav-menu');
        mobileToggle.addEventListener('click', () => {
            navMenu.classList.toggle('active');
            mobileToggle.querySelector('i').classList.toggle('fa-bars');
            mobileToggle.querySelector('i').classList.toggle('fa-times');
        });

        // Modal
        const modal = document.getElementById("messageModal");
        const btnOpenModal = document.getElementById("btn-open-modal");
        const spanClose = document.getElementsByClassName("close-modal")[0];
        btnOpenModal.onclick = function() { modal.style.display = "block"; }
        spanClose.onclick = function() { modal.style.display = "none"; }
        window.onclick = function(event) { if (event.target == modal) modal.style.display = "none"; }

        // Copiar PIX
        const btnCopyPix = document.getElementById('btn-copy-pix');
        btnCopyPix.addEventListener('click', () => {
            const pixKey = document.getElementById('pix-key-text').innerText;
            navigator.clipboard.writeText(pixKey).then(() => {
                const originalText = btnCopyPix.innerText;
                btnCopyPix.innerText = "Copiado!";
                btnCopyPix.style.backgroundColor = "#2C3E50"; 
                btnCopyPix.style.color = "#fff";
                setTimeout(() => {
                    btnCopyPix.innerText = originalText;
                    btnCopyPix.style.backgroundColor = "var(--primary)";
                }, 2000);
            });
        });

        // INICIAR TUDO
        window.addEventListener('DOMContentLoaded', loadSiteData);

    </script>
</body>
</html>