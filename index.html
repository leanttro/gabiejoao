<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gabi & João | Nosso Casamento</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=Montserrat:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- CSS MANTIDO IGUAL --- */
        :root {
            --primary: #2D4A6E; 
            --primary-light: #5B7AA5;
            --accent: #A5C4D4; 
            --bg-light: #FDFDFD; 
            --bg-section: #F0F4F8; 
            --text-main: #2C3E50;
            --text-muted: #7F8C8D;
            --font-serif: 'Cormorant Garamond', serif;
            --font-sans: 'Montserrat', sans-serif;
            --transition: all 1.2s cubic-bezier(0.2, 1, 0.3, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font-sans);
            background-color: var(--bg-light);
            color: var(--text-main);
            line-height: 1.8;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* Loading Overlay */
        #loader-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 99999;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; transition: opacity 0.5s ease;
        }

        /* Chuva de Flores */
        #flower-fall-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 9999; overflow: hidden;
        }
        .falling-flower {
            position: absolute; top: -100px; background-size: contain;
            background-repeat: no-repeat; opacity: 0.6; pointer-events: none;
            animation: fall linear forwards;
        }
        @keyframes fall {
            0% { transform: translateY(0) rotate(0deg) translateX(0); opacity: 0; }
            10% { opacity: 0.6; } 90% { opacity: 0.6; }
            100% { transform: translateY(110vh) rotate(360deg) translateX(50px); opacity: 0; }
        }

        /* Reveal */
        .reveal { opacity: 0; transform: translateY(50px); transition: var(--transition); }
        .reveal.active { opacity: 1; transform: translateY(0); }

        .container { width: 85%; max-width: 1100px; margin: 0 auto; position: relative; }

        header {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
            padding: 2rem 0; transition: var(--transition);
        }
        header.scrolled {
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            padding: 1rem 0; box-shadow: 0 10px 30px rgba(0,0,0,0.03);
        }
        nav { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-family: var(--font-serif); font-size: 2.2rem; color: var(--primary); text-decoration: none; letter-spacing: 5px; font-style: italic; z-index: 1001; }
        .nav-links { display: flex; gap: 2rem; list-style: none; }
        .nav-links a { color: var(--text-main); text-decoration: none; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 2px; font-weight: 600; opacity: 0.8; }
        .nav-links a:hover { color: var(--primary); opacity: 1; }
        .mobile-toggle { display: none; cursor: pointer; font-size: 1.5rem; color: var(--primary); z-index: 1001; }

        /* HERO */
        #home { height: 100vh; position: relative; display: flex; align-items: center; justify-content: center; text-align: center; overflow: hidden; }
        .slideshow { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .slide {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center; opacity: 0;
            transition: opacity 2.5s ease-in-out; transform: scale(1.1);
        }
        .slide.active { opacity: 1; animation: kenBurnsEffect 15s ease-out forwards; }
        @keyframes kenBurnsEffect { 0% { transform: scale(1.1); } 100% { transform: scale(1.02); } }
        .hero-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(180deg, rgba(255,255,255,0.7) 0%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.7) 100%);
            z-index: 0;
        }
        .hero-content { z-index: 10; padding: 2rem; max-width: 900px; }
        .hero-content h1 { 
            font-size: clamp(3.5rem, 12vw, 8rem); margin: 0.2rem 0; 
            color: var(--primary); font-family: var(--font-serif); font-weight: 800; 
            line-height: 1; text-shadow: 0 1px 15px rgba(255,255,255,1);
        }
        .hero-subtitle { 
            text-transform: uppercase; letter-spacing: 6px; font-size: 1rem; 
            color: var(--primary); margin-bottom: 1rem; font-weight: 700; 
            text-shadow: 0 0 20px rgba(255,255,255,1);
        }
        .hero-date { 
            font-size: 2.4rem; font-family: var(--font-serif); font-style: italic; 
            color: var(--text-main); margin-bottom: 4rem; letter-spacing: 3px;
            display: flex; align-items: center; justify-content: center; gap: 25px; font-weight: 900; 
        }
        .hero-date::before, .hero-date::after { content: ''; width: 70px; height: 4px; background: var(--primary); display: inline-block; }
        .btn-hero {
            display: inline-block; padding: 1.4rem 4.5rem; background: var(--primary); 
            color: white; text-decoration: none; text-transform: uppercase; 
            font-size: 0.9rem; letter-spacing: 5px; border-radius: 2px;
            transition: var(--transition); border: 3px solid var(--primary); font-weight: 800; cursor: pointer;
        }
        .btn-hero:hover { background: transparent; color: var(--primary); transform: translateY(-5px); }

        section { padding: 140px 0; position: relative; }
        .section-header { text-align: center; margin-bottom: 80px; }
        .section-header h2 { font-size: 3.5rem; font-family: var(--font-serif); color: var(--primary); font-weight: 500; }

        /* NOVA CLASSE PARA O CASAL */
        .casal-grid {
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 5rem; 
            align-items: center;
        }

        /* História */
        #historia {
            padding-top: 70px; padding-bottom: 70px; background-color: var(--bg-section);
            background-image: radial-gradient(circle at 10% 20%, rgba(165, 196, 212, 0.2) 0%, transparent 40%),
                              radial-gradient(circle at 90% 80%, rgba(165, 196, 212, 0.2) 0%, transparent 40%);
        }
        .history-card { display: flex; gap: 5rem; margin-bottom: 10rem; align-items: center; }
        #historia .history-card:last-of-type { margin-bottom: 5rem; }
        .history-card:nth-child(even) { flex-direction: row-reverse; }

        .history-img-box { flex: 1.2; position: relative; }
        .history-img-box img {
            width: 100%; height: 450px; object-fit: cover;
            border-radius: 120px 30px 120px 30px; 
            box-shadow: 25px 25px 70px rgba(0,0,0,0.06); transition: var(--transition);
        }
        .history-card:hover .history-img-box img { transform: scale(1.03) rotate(1deg); }
        .history-text-box { flex: 1; }
        .history-tag { font-family: var(--font-serif); font-size: 4rem; color: var(--accent); font-style: italic; opacity: 0.7; margin-bottom: -15px; display: block; }
        .history-text-box h3 { font-size: 2.2rem; margin-bottom: 1.5rem; color: var(--primary); }

        #eventos { padding-top: 70px; }
        .events-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 3rem; }
        .event-card { background: white; padding: 4rem 2rem; text-align: center; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.03); border: 1px solid rgba(165, 196, 212, 0.2); transition: var(--transition); }
        .event-card:hover { transform: translateY(-10px); }
        .event-card i { font-size: 2.5rem; color: var(--accent); margin-bottom: 2rem; }
        .map-wrapper { margin-top: 4rem; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.05); }

        #presentes { padding-top: 70px; }
        .pix-area { background: white; padding: 4rem; border-radius: 30px; border: 2px dashed var(--accent); margin: 3rem 0; text-align: center; }
        .pix-key { font-size: 1.4rem; font-weight: 700; color: var(--primary); padding: 15px; background: var(--bg-section); display: inline-block; border-radius: 10px; margin-top: 1rem; }
        .gift-buttons { display: flex; gap: 2rem; justify-content: center; margin-top: 2rem; }

        #recados { padding-top: 70px; }
        .messages-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }
        .message-item { background: white; padding: 3rem; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.02); border-left: 5px solid var(--accent); font-style: italic; }

        #rsvp { padding-top: 70px; }
        .rsvp-container { max-width: 800px; margin: 0 auto; background: white; padding: 5rem; border-radius: 35px; box-shadow: 0 30px 60px rgba(0,0,0,0.04); border: 1px solid rgba(165, 196, 212, 0.2); }
        .form-control { width: 100%; border: none; border-bottom: 2px solid #E9F0F5; padding: 15px 0; margin-bottom: 2.5rem; font-size: 1.1rem; outline: none; }

        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(5px); }
        .modal-content { background-color: #fefefe; margin: 10% auto; padding: 40px; border-radius: 20px; border: 1px solid #888; width: 90%; max-width: 600px; box-shadow: 0 5px 30px rgba(0,0,0,0.3); position: relative; animation: modalFadeIn 0.3s; }
        @keyframes modalFadeIn { from {opacity: 0; transform: translateY(-50px);} to {opacity: 1; transform: translateY(0);} }
        .close-modal { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close-modal:hover { color: var(--primary); }

        footer { background: var(--primary); color: white; text-align: center; padding: 90px 0; }

        @media (max-width: 900px) {
            .mobile-toggle { display: block; }
            .nav-links { position: fixed; top: 0; right: -100%; width: 80%; height: 100vh; background: white; flex-direction: column; justify-content: center; align-items: center; gap: 2.5rem; transition: 0.5s; box-shadow: -15px 0 40px rgba(0,0,0,0.05); z-index: 1000; }
            .nav-links.active { right: 0; }
            
            /* Correção para o Mobile - O CASAL */
            .casal-grid { grid-template-columns: 1fr; gap: 2rem; text-align: center; }

            .history-card, .history-card:nth-child(even) { flex-direction: column; gap: 3rem; text-align: center; }
            .history-img-box img { height: 350px; }
            .events-grid { grid-template-columns: 1fr; }
            .hero-content h1 { font-size: 3.8rem; }
            .gift-buttons { flex-direction: column; }

            /* CORREÇÃO DO BOTÃO RSVP MOBILE */
            #rsvp-form .btn-hero {
                width: 100% !important;
                padding: 1.2rem 0; 
                letter-spacing: 2px; 
                font-size: 0.8rem; 
                white-space: nowrap; 
            }

            /* CORREÇÃO DA DATA HERO MOBILE */
            .hero-date {
                font-size: 1.5rem; /* Fonte menor */
                gap: 10px; /* Menos espaço entre itens */
                white-space: nowrap; /* Impede quebra de linha */
            }
            .hero-date::before, .hero-date::after {
                width: 20px; /* Linhas laterais menores para dar espaço */
            }
        }
    </style>
</head>
<body>

    <div id="loader-overlay">
        <i class="fas fa-heart fa-spin" style="font-size: 3rem; color: #2D4A6E;"></i>
    </div>

    <div id="flower-fall-container"></div>

    <header id="main-header">
        <div class="container">
            <nav>
                <a href="#home" class="logo" id="nav-logo">G&J</a>
                <ul class="nav-links" id="nav-menu">
                    <li><a href="#home">Início</a></li>
                    <li><a href="#casal">O Casal</a></li>
                    <li><a href="#historia">História</a></li>
                    <li><a href="#eventos">Eventos</a></li>
                    <li><a href="#presentes">Presentes</a></li>
                    <li><a href="#recados">Recados</a></li>
                    <li><a href="#rsvp">RSVP</a></li>
                </ul>
                <div class="mobile-toggle" id="mobile-toggle"><i class="fas fa-bars"></i></div>
            </nav>
        </div>
    </header>

    <section id="home">
        <div class="slideshow">
            <div class="slide active" style="background-image: url('hero1.png');"></div>
            <div class="slide" style="background-image: url('hero2.png');"></div>
            <div class="slide" style="background-image: url('hero3.png');"></div>
        </div>
        <div class="hero-overlay"></div>
        <div class="hero-content reveal">
            <p class="hero-subtitle" id="hero-subtitle">Com a bênção de nossos pais,</p>
            <h1 id="hero-title">Gabi & João</h1>
            <p class="hero-date" id="hero-date">27 . 02 . 2026</p>
            <a href="#rsvp" class="btn-hero">Confirmar Presença</a>
        </div>
    </section>

    <section id="casal">
        <div class="container">
            <div class="casal-grid">
                <div class="reveal">
                    <img src="casal_perfil.png" id="casal-foto" alt="O Casal" style="width: 100%; border-radius: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.05);">
                </div>
                <div class="reveal">
                    <h2 style="font-family: var(--font-serif); font-size: 3rem; margin-bottom: 2rem;">O Casal</h2>
                    <p id="texto-casal">Nossa jornada começou com um simples encontro e floresceu em uma vida compartilhada cheia de sonhos. Cada passo que demos nos trouxe até este momento único.</p>
                    <div id="assinatura-casal" style="font-family: var(--font-serif); font-size: 2.5rem; font-style: italic; color: var(--primary); margin-top: 3rem;">Gabi & João</div>
                </div>
            </div>
        </div>
    </section>

    <section id="historia">
        <div class="container">
            <div class="section-header reveal">
                <h2>Nossa História</h2>
                <p>Momentos inesquecíveis da nossa caminhada.</p>
            </div>

            <div id="historia-container">
                </div>
        </div>
    </section>

    <section id="eventos" style="background: var(--bg-section);">
        <div class="container">
            <div class="section-header reveal">
                <h2>Onde e Quando</h2>
            </div>
            
            <div class="events-grid" id="eventos-container">
                </div>

            <div class="map-wrapper reveal">
                <iframe id="mapa-iframe" src="" width="100%" height="400" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
            </div>
        </div>
    </section>

    <section id="presentes">
        <div class="container">
            <div class="section-header reveal">
                <h2>Lista de Presentes</h2>
            </div>
            <div class="pix-area reveal">
                <i class="fas fa-heart" style="font-size: 2.5rem; color: var(--accent); margin-bottom: 1rem;"></i>
                <h3>Presente via PIX</h3>
                <div class="pix-key" id="pix-key-text">chave-pix-noivos@email.com</div>
                <div style="margin-top: 15px;">
                    <button id="btn-copy-pix" class="btn-hero" style="padding: 1rem 2rem; font-size: 0.8rem;">Copiar Chave</button>
                </div>
                <p style="margin-top: 1rem; color: var(--text-muted);">Copie a chave para contribuir com nossa Lua de Mel.</p>
            </div>
            <div class="gift-buttons reveal">
                <a href="#" id="link-lista-1" class="btn-hero" style="font-size: 0.7rem; padding: 1rem 2rem;">Lista Magalu</a>
                <a href="#" id="link-lista-2" class="btn-hero" style="font-size: 0.7rem; padding: 1rem 2rem;">Lista Camicado</a>
            </div>
        </div>
    </section>

    <section id="recados" style="background: var(--bg-section);">
        <div class="container">
            <div class="section-header reveal">
                <h2>Recados Carinhosos</h2>
                <div style="margin-top: 2rem;">
                    <button id="btn-open-modal" class="btn-hero" style="font-size: 0.8rem; padding: 1rem 3rem;">Deixar um Recado</button>
                </div>
            </div>
            <div class="messages-grid" id="recados-container">
                </div>
        </div>
    </section>

    <div id="messageModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">×</span>
            <h3 style="font-family: var(--font-serif); font-size: 2rem; color: var(--primary); margin-bottom: 1.5rem; text-align: center;">Deixe sua Mensagem</h3>
            <form id="message-form">
                <input type="text" id="msg_name" class="form-control" placeholder="Seu Nome" required>
                <input type="text" id="msg_code" class="form-control" placeholder="Código do Convite (Opcional)">
                <textarea id="message_text" class="form-control" placeholder="Escreva sua mensagem..." rows="4" required style="border-bottom: 2px solid #E9F0F5; resize: none;"></textarea>
                <button type="submit" class="btn-hero" style="width: 100%; margin-top: 1rem;">Enviar para Aprovação</button>
            </form>
            <div id="message-feedback" style="display:none; text-align:center; margin-top: 1rem; color: var(--primary); font-weight: bold;">
                Mensagem enviada!
            </div>
        </div>
    </div>

    <section id="rsvp">
        <div class="container">
            <div class="section-header reveal">
                <h2>Confirmar Presença</h2>
                <p>Por favor, confirme sua presença.</p>
            </div>
            <div class="rsvp-container reveal">
                <form id="rsvp-form">
                    <input type="text" id="rsvp_code" class="form-control" placeholder="Código do Convite (Ex: 0001)" required>
                    <input type="text" id="rsvp_name" class="form-control" placeholder="Seu Nome Completo" required>
                    <input type="email" id="rsvp_email" class="form-control" placeholder="Seu e-mail" required>
                    <select id="rsvp_guests" class="form-control">
                        <option value="1">Apenas eu</option>
                        <option value="2">2 Pessoas</option>
                        <option value="3">3 Pessoas</option>
                        <option value="4">4 Pessoas</option>
                    </select>
                    <button type="submit" class="btn-hero" style="width: 100%;">Confirmar Agora</button>
                </form>
                <div id="form-feedback" style="display:none; text-align:center; margin-top: 2rem;">
                    <h3 style="font-family: var(--font-serif); font-size: 2rem; color: var(--primary);">Obrigado!</h3>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-logo" id="footer-logo">Gabi & João</div>
            <p id="footer-date">BRASÍLIA • 2026</p>
        </div>
    </footer>

    <script>
        const DIRECTUS_URL = "https://eventosdirectus.leanttro.com"; 

        function getImgUrl(fileId) {
            if (!fileId) return null;
            return `${DIRECTUS_URL}/assets/${fileId}`;
        }

        async function loadSiteData() {
            try {
                // 1. Configurações
                const configReq = await fetch(`${DIRECTUS_URL}/items/configuracoes_gerais`);
                const configResponse = await configReq.json();
                let config = null;
                if (configResponse.data) config = Array.isArray(configResponse.data) ? configResponse.data[0] : configResponse.data;

                if(config) {
                    document.title = config.titulo_site || "Casamento";
                    if(document.getElementById('nav-logo')) document.getElementById('nav-logo').innerText = config.titulo_site;
                    if(document.getElementById('hero-title')) document.getElementById('hero-title').innerText = config.titulo_site;
                    if(document.getElementById('footer-logo')) document.getElementById('footer-logo').innerText = config.titulo_site;
                    if(document.getElementById('hero-subtitle')) document.getElementById('hero-subtitle').innerText = config.subtitulo_hero;
                    if(document.getElementById('texto-casal')) document.getElementById('texto-casal').innerText = config.texto_casal;
                    if(document.getElementById('assinatura-casal')) document.getElementById('assinatura-casal').innerText = config.titulo_site;
                    if(document.getElementById('pix-key-text')) document.getElementById('pix-key-text').innerText = config.chave_pix;
                    
                    if(document.getElementById('mapa-iframe') && config.iframe_mapa) document.getElementById('mapa-iframe').src = config.iframe_mapa;
                    if(document.getElementById('link-lista-1')) document.getElementById('link-lista-1').href = config.link_lista_1 || "#";
                    if(document.getElementById('link-lista-2')) document.getElementById('link-lista-2').href = config.link_lista_2 || "#";

                    if(config.foto_casal) document.getElementById('casal-foto').src = getImgUrl(config.foto_casal);
                    
                    // Banner Slides
                    const slideElements = document.querySelectorAll('.slide');
                    if (config.banner_1 && slideElements[0]) slideElements[0].style.backgroundImage = `url('${getImgUrl(config.banner_1)}')`;
                    if (config.banner_2 && slideElements[1]) slideElements[1].style.backgroundImage = `url('${getImgUrl(config.banner_2)}')`;
                    if (config.banner_3 && slideElements[2]) slideElements[2].style.backgroundImage = `url('${getImgUrl(config.banner_3)}')`;

                    if(config.data_casamento) {
                        const dataObj = new Date(config.data_casamento);
                        const dataCorrigida = new Date(dataObj.getTime() + dataObj.getTimezoneOffset() * 60000);
                        document.getElementById('hero-date').innerText = dataCorrigida.toLocaleDateString('pt-BR').replace(/\//g, ' . ');
                        document.getElementById('footer-date').innerText = `BRASÍLIA • ${dataCorrigida.getFullYear()}`;
                    }
                }

                // 2. História
                const histReq = await fetch(`${DIRECTUS_URL}/items/historia?sort=sort`);
                const histData = await histReq.json();
                const histContainer = document.getElementById('historia-container');
                if(histData.data && histData.data.length > 0) {
                    histContainer.innerHTML = ''; 
                    histData.data.forEach((item) => {
                        const imgUrl = getImgUrl(item.foto) || 'historia1.png';
                        const html = `
                        <div class="history-card reveal">
                            <div class="history-img-box"><img src="${imgUrl}" alt="${item.titulo}"></div>
                            <div class="history-text-box">
                                <span class="history-tag">${item.ano}</span>
                                <h3>${item.titulo}</h3>
                                <p>${item.descricao}</p>
                            </div>
                        </div>`;
                        histContainer.innerHTML += html;
                    });
                }

                // 3. Eventos
                const eventReq = await fetch(`${DIRECTUS_URL}/items/eventos?sort=sort`);
                const eventData = await eventReq.json();
                const eventContainer = document.getElementById('eventos-container');
                if(eventData.data && eventData.data.length > 0) {
                    eventContainer.innerHTML = ''; 
                    eventData.data.forEach(item => {
                        const dataEvento = new Date(item.data_hora);
                        const dia = dataEvento.toLocaleDateString('pt-BR', { day: 'numeric', month: 'long' });
                        const hora = dataEvento.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                        const iconeClass = item.icone || 'fa-calendar-alt';
                        const html = `
                        <div class="event-card reveal">
                            <i class="fas ${iconeClass}"></i>
                            <h3>${item.titulo}</h3>
                            <p>${dia}<br>${hora}h</p>
                            <p style="margin-top: 10px; font-weight: 700;">${item.local_nome}</p>
                        </div>`;
                        eventContainer.innerHTML += html;
                    });
                }

                // 4. Recados
                const recadosReq = await fetch(`${DIRECTUS_URL}/items/recados?filter[status][_eq]=published&sort=-date_created&limit=6`);
                if (recadosReq.ok) {
                    const recadosData = await recadosReq.json();
                    const recadosContainer = document.getElementById('recados-container');
                    if(recadosData.data && recadosData.data.length > 0) {
                        recadosContainer.innerHTML = '';
                        recadosData.data.forEach(msg => {
                            const html = `
                            <div class="message-item reveal">
                                <p>"${msg.mensagem}"</p>
                                <span style="display:block; margin-top:1rem; font-weight:700;">— ${msg.nome_remetente}</span>
                            </div>`;
                            recadosContainer.innerHTML += html;
                        });
                    }
                }

            } catch (error) {
                console.error("Erro API:", error);
            } finally {
                const loader = document.getElementById('loader-overlay');
                if(loader) { loader.style.opacity = '0'; setTimeout(() => loader.remove(), 500); }
            }
        }

        // --- INTERAÇÕES ---
        const flowerContainer = document.getElementById('flower-fall-container');
        const flowerImages = ['flor1.png', 'flor2.png', 'flor3.png', 'flor4.png'];
        function createFlower() {
            const flower = document.createElement('div');
            flower.classList.add('falling-flower');
            const size = Math.random() * (30 - 15) + 15; 
            const startX = Math.random() * window.innerWidth;
            const duration = Math.random() * (12 - 7) + 7; 
            const img = flowerImages[Math.floor(Math.random() * flowerImages.length)];
            flower.style.width = `${size}px`; flower.style.height = `${size}px`; flower.style.left = `${startX}px`;
            flower.style.backgroundImage = `url('${img}')`; flower.style.animationDuration = `${duration}s`;
            flowerContainer.appendChild(flower);
            setTimeout(() => { flower.remove(); }, duration * 1000);
        }
        setInterval(createFlower, 600);

        const slides = document.querySelectorAll('.slide');
        let currentSlide = 0;
        function nextSlide() {
            if(slides.length > 0) {
                slides[currentSlide].classList.remove('active');
                currentSlide = (currentSlide + 1) % slides.length;
                slides[currentSlide].classList.add('active');
            }
        }
        setInterval(nextSlide, 6000);

        window.addEventListener('scroll', () => {
            const header = document.querySelector('header');
            if (window.scrollY > 50) header.classList.add('scrolled');
            else header.classList.remove('scrolled');
        });

        const mobileToggle = document.getElementById('mobile-toggle');
        const navMenu = document.getElementById('nav-menu');
        mobileToggle.addEventListener('click', () => {
            navMenu.classList.toggle('active');
            mobileToggle.querySelector('i').classList.toggle('fa-bars');
            mobileToggle.querySelector('i').classList.toggle('fa-times');
        });

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('active'); });
        }, { threshold: 0.1 });
        setInterval(() => { document.querySelectorAll('.reveal:not(.active)').forEach(el => observer.observe(el)); }, 1000);

        const btnCopyPix = document.getElementById('btn-copy-pix');
        btnCopyPix.addEventListener('click', () => {
            const pixKey = document.getElementById('pix-key-text').innerText;
            navigator.clipboard.writeText(pixKey).then(() => {
                const originalText = btnCopyPix.innerText;
                btnCopyPix.innerText = "Copiado!";
                setTimeout(() => { btnCopyPix.innerText = originalText; }, 2000);
            });
        });

        const modal = document.getElementById("messageModal");
        const btnOpenModal = document.getElementById("btn-open-modal");
        const spanClose = document.getElementsByClassName("close-modal")[0];
        btnOpenModal.onclick = function() { modal.style.display = "block"; }
        spanClose.onclick = function() { modal.style.display = "none"; }
        window.onclick = function(event) { if (event.target == modal) modal.style.display = "none"; }

        // --- RSVP COM VALIDAÇÃO ---
        const rsvpForm = document.getElementById('rsvp-form');
        rsvpForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = rsvpForm.querySelector('button');
            const codeInput = document.getElementById('rsvp_code').value.trim();
            
            btn.textContent = 'Verificando convite...'; btn.disabled = true;
            
            try {
                // 1. Validar Código
                // Nota: Certifique-se que a coleção 'convidados' tem permissão de LEITURA Pública no Directus
                const checkReq = await fetch(`${DIRECTUS_URL}/items/convidados?filter[codigo][_eq]=${codeInput}`);
                const checkData = await checkReq.json();

                if (!checkData.data || checkData.data.length === 0) {
                    alert('Código de convite inválido ou não encontrado.');
                    btn.textContent = 'Confirmar Agora'; btn.disabled = false;
                    return;
                }

                // Código válido, prosseguir com o envio
                btn.textContent = 'Enviando...';
                const payload = {
                    codigo_convite: codeInput,
                    nome_completo: document.getElementById('rsvp_name').value,
                    email: document.getElementById('rsvp_email').value,
                    qtd_convidados: parseInt(document.getElementById('rsvp_guests').value)
                };
                
                const res = await fetch(`${DIRECTUS_URL}/items/rsvp`, { 
                    method: 'POST', 
                    headers: {'Content-Type':'application/json'}, 
                    body: JSON.stringify(payload)
                });

                if(res.ok) { 
                    rsvpForm.style.display='none'; 
                    document.getElementById('form-feedback').style.display='block'; 
                } else { 
                    alert('Erro ao confirmar. Tente novamente.'); 
                    btn.disabled=false; btn.textContent='Confirmar Agora'; 
                }
            } catch(e) { 
                console.error(e);
                alert('Erro de conexão com o servidor.'); 
                btn.disabled=false; btn.textContent='Confirmar Agora';
            }
        });

        // Form Recados
        const msgForm = document.getElementById("message-form");
        msgForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = msgForm.querySelector('button');
            btn.textContent = 'Enviando...'; btn.disabled = true;
            try {
                const payload = {
                    nome_remetente: document.getElementById('msg_name').value,
                    codigo_convite: document.getElementById('msg_code').value,
                    mensagem: document.getElementById('message_text').value,
                    status: 'draft'
                };
                const res = await fetch(`${DIRECTUS_URL}/items/recados`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(payload)});
                if(res.ok) { 
                    msgForm.style.display='none'; document.getElementById('message-feedback').style.display='block';
                    setTimeout(() => { modal.style.display='none'; msgForm.reset(); msgForm.style.display='block'; document.getElementById('message-feedback').style.display='none'; btn.textContent='Enviar'; btn.disabled=false; }, 2000);
                } else { alert('Erro.'); btn.disabled=false; }
            } catch(e) { alert('Erro de conexão'); btn.disabled=false; }
        });

        window.addEventListener('DOMContentLoaded', loadSiteData);
    </script>
</body>
</html>